<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Watermark Tool - Add Watermark to Images Online | ToolKit Pro</title>
    <meta name="description" content="Add text or image watermark to photos online. Customize position, size, opacity. Works offline in your browser.">
    <meta name="keywords" content="watermark tool, add watermark, image watermark, photo watermark">
    <link rel="canonical" href="https://yourdomain.com/image-watermark">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>üíß Image Watermark Tool</h1>
        <p class="subtitle">Add text or image watermark to your photos. Customize position, size, and opacity.</p>

        <div class="workspace" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <!-- Left: Upload & Preview -->
            <div>
                <div id="uploadArea" style="margin-bottom: 12px;">
                    <div style="border: 2px dashed var(--border); border-radius: 8px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s;" id="dropZone" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 2rem; margin-bottom: 5px;">üìÅ</div>
                        <div style="font-size: 0.85rem; color: var(--white); margin-bottom: 3px;">Click to upload image</div>
                        <div style="font-size: 0.7rem; color: var(--gray);">JPG, PNG, WebP</div>
                    </div>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFile(this.files[0])">
                </div>

                <!-- Preview Canvas -->
                <div id="previewArea" style="display: none; background: var(--light); border-radius: 8px; padding: 12px; border: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-size: 0.75rem; color: var(--gray);">üí° Drag watermark to reposition</div>
                        <button onclick="uploadNew()" style="padding: 4px 10px; font-size: 0.7rem; background: var(--primary); border: none; border-radius: 4px; color: white; cursor: pointer;">üìÅ Upload New</button>
                    </div>
                    <canvas id="canvas" style="max-width: 100%; max-height: 400px; border-radius: 6px; cursor: move;"></canvas>
                </div>
            </div>

            <!-- Right: Controls -->
            <div id="controls" style="display: none;">
                <!-- Watermark Type -->
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; margin-bottom: 6px; display: block; color: var(--gray);">Watermark Type</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                        <button onclick="setWatermarkType('text')" id="type-text" class="type-btn active" style="padding: 8px; background: var(--primary); border: 1px solid var(--primary); border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: white;">üìù Text</button>
                        <button onclick="setWatermarkType('image')" id="type-image" class="type-btn" style="padding: 8px; background: var(--light); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: var(--white);">üñºÔ∏è Image</button>
                    </div>
                </div>

                <!-- Text Watermark Controls -->
                <div id="textControls">
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Watermark Text</label>
                        <input type="text" id="watermarkText" value="¬© Your Name" oninput="updateWatermark()" style="width: 100%; padding: 8px; font-size: 0.85rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--white);">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Font Size</label>
                            <input type="number" id="fontSize" value="36" min="10" max="200" oninput="updateWatermark()" style="width: 100%; padding: 8px; font-size: 0.85rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--white);">
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Text Color</label>
                            <input type="color" id="textColor" value="#ffffff" oninput="updateWatermark()" style="width: 100%; height: 38px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; background: var(--dark);">
                        </div>
                    </div>
                </div>

                <!-- Image Watermark Controls -->
                <div id="imageControls" style="display: none;">
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Watermark Image</label>
                        <input type="file" id="watermarkImageInput" accept="image/*" onchange="handleWatermarkImage(this.files[0])" style="width: 100%; padding: 8px; font-size: 0.8rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--white);">
                    </div>

                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Size (%)</label>
                        <input type="range" id="watermarkSize" min="5" max="50" value="20" oninput="updateWatermark(); document.getElementById('watermarkSize-val').textContent = this.value + '%'" style="width: 100%;">
                        <div style="text-align: right; font-size: 0.7rem; color: var(--primary); margin-top: 2px;" id="watermarkSize-val">20%</div>
                    </div>
                </div>

                <!-- Common Controls -->
                <div style="background: var(--light); border-radius: 8px; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border);">
                    <!-- Position -->
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.75rem; margin-bottom: 6px; display: block; color: var(--gray);">Position</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px;">
                            <button onclick="setPosition('top-left')" class="pos-btn" id="pos-top-left" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚ÜñÔ∏è</button>
                            <button onclick="setPosition('top-center')" class="pos-btn" id="pos-top-center" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚¨ÜÔ∏è</button>
                            <button onclick="setPosition('top-right')" class="pos-btn" id="pos-top-right" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚ÜóÔ∏è</button>
                            <button onclick="setPosition('middle-left')" class="pos-btn" id="pos-middle-left" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚¨ÖÔ∏è</button>
                            <button onclick="setPosition('center')" class="pos-btn" id="pos-center" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚è∫Ô∏è</button>
                            <button onclick="setPosition('middle-right')" class="pos-btn" id="pos-middle-right" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚û°Ô∏è</button>
                            <button onclick="setPosition('bottom-left')" class="pos-btn" id="pos-bottom-left" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚ÜôÔ∏è</button>
                            <button onclick="setPosition('bottom-center')" class="pos-btn" id="pos-bottom-center" style="padding: 6px; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: var(--white);">‚¨áÔ∏è</button>
                            <button onclick="setPosition('bottom-right')" class="pos-btn active" id="pos-bottom-right" style="padding: 6px; background: var(--primary); border: 1px solid var(--primary); border-radius: 4px; cursor: pointer; font-size: 0.7rem; color: white;">‚ÜòÔ∏è</button>
                        </div>
                    </div>

                    <!-- Opacity -->
                    <div>
                        <label style="font-size: 0.75rem; margin-bottom: 4px; display: block; color: var(--gray);">Opacity</label>
                        <input type="range" id="opacity" min="10" max="100" value="70" oninput="updateWatermark(); document.getElementById('opacity-val').textContent = this.value + '%'" style="width: 100%;">
                        <div style="text-align: right; font-size: 0.7rem; color: var(--primary); margin-top: 2px;" id="opacity-val">70%</div>
                    </div>
                </div>

                <!-- Download Button -->
                <button onclick="downloadImage()" class="btn btn-success" style="width: 100%; padding: 10px; font-size: 0.95rem;">üíæ Download Watermarked Image</button>
            </div>
        </div>

        <div class="info-section">
            <h2>Image Watermark Tool - Protect Your Images</h2>
            <p>Add text or image watermarks to protect your photos and images. Customize the watermark position, size, opacity, and color. Perfect for photographers, content creators, and businesses.</p>
            <p><strong>Text Watermark:</strong> Add copyright text, your name, or website URL with custom font size and color.</p>
            <p><strong>Image Watermark:</strong> Upload your logo or signature as a watermark with adjustable size and opacity.</p>
            <p><strong>Privacy:</strong> All processing happens in your browser. No files uploaded to any server.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        let originalImage = null;
        let watermarkImage = null;
        let canvas, ctx;
        let watermarkType = 'text';
        let position = 'bottom-right';
        let customPosition = null; // For manual positioning
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let watermarkBounds = { x: 0, y: 0, width: 0, height: 0 };

        // Drag and drop
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--primary)';
            dropZone.style.background = 'rgba(249, 115, 22, 0.1)';
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'var(--border)';
            dropZone.style.background = 'transparent';
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--border)';
            dropZone.style.background = 'transparent';
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                showToast('Please select an image', true);
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage = new Image();
                originalImage.onload = () => {
                    initCanvas();
                    document.getElementById('uploadArea').style.display = 'none';
                    document.getElementById('previewArea').style.display = 'block';
                    document.getElementById('controls').style.display = 'block';
                };
                originalImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function handleWatermarkImage(file) {
            if (!file || !file.type.startsWith('image/')) {
                showToast('Please select an image', true);
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                watermarkImage = new Image();
                watermarkImage.onload = () => {
                    updateWatermark();
                };
                watermarkImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function initCanvas() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            const maxWidth = 450;
            const scale = Math.min(1, maxWidth / originalImage.width);
            canvas.width = originalImage.width * scale;
            canvas.height = originalImage.height * scale;

            // Add mouse events for dragging
            canvas.addEventListener('mousedown', startDrag);
            canvas.addEventListener('mousemove', drag);
            canvas.addEventListener('mouseup', endDrag);
            canvas.addEventListener('mouseleave', endDrag);

            updateWatermark();
        }

        function setWatermarkType(type) {
            watermarkType = type;

            // Update button styles
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.style.background = 'var(--light)';
                btn.style.borderColor = 'var(--border)';
                btn.style.color = 'var(--white)';
            });
            document.getElementById('type-' + type).style.background = 'var(--primary)';
            document.getElementById('type-' + type).style.borderColor = 'var(--primary)';
            document.getElementById('type-' + type).style.color = 'white';

            // Show/hide controls
            if (type === 'text') {
                document.getElementById('textControls').style.display = 'block';
                document.getElementById('imageControls').style.display = 'none';
            } else {
                document.getElementById('textControls').style.display = 'none';
                document.getElementById('imageControls').style.display = 'block';
            }

            updateWatermark();
        }

        function setPosition(pos) {
            position = pos;
            customPosition = null; // Reset custom position

            // Update button styles
            document.querySelectorAll('.pos-btn').forEach(btn => {
                btn.style.background = 'var(--dark)';
                btn.style.borderColor = 'var(--border)';
                btn.style.color = 'var(--white)';
            });
            document.getElementById('pos-' + pos).style.background = 'var(--primary)';
            document.getElementById('pos-' + pos).style.borderColor = 'var(--primary)';
            document.getElementById('pos-' + pos).style.color = 'white';

            updateWatermark();
        }

        function startDrag(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // Check if mouse is over watermark
            if (mouseX >= watermarkBounds.x && 
                mouseX <= watermarkBounds.x + watermarkBounds.width &&
                mouseY >= watermarkBounds.y && 
                mouseY <= watermarkBounds.y + watermarkBounds.height) {
                
                isDragging = true;
                dragOffset.x = mouseX - watermarkBounds.x;
                dragOffset.y = mouseY - watermarkBounds.y;
                canvas.style.cursor = 'grabbing';
            }
        }

        function drag(e) {
            if (!isDragging) {
                // Change cursor when hovering over watermark
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                if (mouseX >= watermarkBounds.x && 
                    mouseX <= watermarkBounds.x + watermarkBounds.width &&
                    mouseY >= watermarkBounds.y && 
                    mouseY <= watermarkBounds.y + watermarkBounds.height) {
                    canvas.style.cursor = 'grab';
                } else {
                    canvas.style.cursor = 'move';
                }
                return;
            }

            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // Calculate new position
            let newX = mouseX - dragOffset.x;
            let newY = mouseY - dragOffset.y;

            // Keep watermark within canvas bounds
            newX = Math.max(0, Math.min(newX, canvas.width - watermarkBounds.width));
            newY = Math.max(0, Math.min(newY, canvas.height - watermarkBounds.height));

            customPosition = { x: newX, y: newY };

            // Deselect position buttons when using custom position
            document.querySelectorAll('.pos-btn').forEach(btn => {
                btn.style.background = 'var(--dark)';
                btn.style.borderColor = 'var(--border)';
                btn.style.color = 'var(--white)';
            });

            updateWatermark();
        }

        function endDrag() {
            if (isDragging) {
                isDragging = false;
                canvas.style.cursor = 'move';
            }
        }

        function updateWatermark() {
            if (!originalImage) return;

            // Draw original image
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

            const opacity = document.getElementById('opacity').value / 100;
            ctx.globalAlpha = opacity;

            if (watermarkType === 'text') {
                drawTextWatermark();
            } else if (watermarkType === 'image' && watermarkImage) {
                drawImageWatermark();
            }

            ctx.globalAlpha = 1;
        }

        function drawTextWatermark() {
            const text = document.getElementById('watermarkText').value;
            const fontSize = document.getElementById('fontSize').value;
            const color = document.getElementById('textColor').value;

            ctx.font = `bold ${fontSize}px Arial`;
            ctx.fillStyle = color;
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.lineWidth = 2;

            const metrics = ctx.measureText(text);
            const textWidth = metrics.width;
            const textHeight = fontSize;

            let coords;
            if (customPosition) {
                coords = { x: customPosition.x, y: customPosition.y + textHeight };
            } else {
                coords = getPositionCoordinates(textWidth, textHeight);
            }

            // Store bounds for drag detection
            watermarkBounds = {
                x: coords.x,
                y: coords.y - textHeight,
                width: textWidth,
                height: textHeight
            };

            ctx.strokeText(text, coords.x, coords.y);
            ctx.fillText(text, coords.x, coords.y);
        }

        function drawImageWatermark() {
            const sizePercent = document.getElementById('watermarkSize').value / 100;
            const wmWidth = canvas.width * sizePercent;
            const wmHeight = (watermarkImage.height / watermarkImage.width) * wmWidth;

            let coords;
            if (customPosition) {
                coords = { x: customPosition.x, y: customPosition.y };
            } else {
                coords = getPositionCoordinates(wmWidth, wmHeight);
            }

            // Store bounds for drag detection
            watermarkBounds = {
                x: coords.x,
                y: coords.y,
                width: wmWidth,
                height: wmHeight
            };

            ctx.drawImage(watermarkImage, coords.x, coords.y, wmWidth, wmHeight);
        }

        function getPositionCoordinates(width, height) {
            const padding = 20;
            let x, y;

            switch (position) {
                case 'top-left':
                    x = padding;
                    y = padding + height;
                    break;
                case 'top-center':
                    x = (canvas.width - width) / 2;
                    y = padding + height;
                    break;
                case 'top-right':
                    x = canvas.width - width - padding;
                    y = padding + height;
                    break;
                case 'middle-left':
                    x = padding;
                    y = (canvas.height + height) / 2;
                    break;
                case 'center':
                    x = (canvas.width - width) / 2;
                    y = (canvas.height + height) / 2;
                    break;
                case 'middle-right':
                    x = canvas.width - width - padding;
                    y = (canvas.height + height) / 2;
                    break;
                case 'bottom-left':
                    x = padding;
                    y = canvas.height - padding;
                    break;
                case 'bottom-center':
                    x = (canvas.width - width) / 2;
                    y = canvas.height - padding;
                    break;
                case 'bottom-right':
                    x = canvas.width - width - padding;
                    y = canvas.height - padding;
                    break;
            }

            return { x, y };
        }

        function downloadImage() {
            // Create full-size canvas
            const downloadCanvas = document.createElement('canvas');
            const downloadCtx = downloadCanvas.getContext('2d');
            downloadCanvas.width = originalImage.width;
            downloadCanvas.height = originalImage.height;

            // Draw original image
            downloadCtx.drawImage(originalImage, 0, 0);

            // Apply watermark
            const scale = originalImage.width / canvas.width;
            const opacity = document.getElementById('opacity').value / 100;
            downloadCtx.globalAlpha = opacity;

            if (watermarkType === 'text') {
                const text = document.getElementById('watermarkText').value;
                const fontSize = document.getElementById('fontSize').value * scale;
                const color = document.getElementById('textColor').value;

                downloadCtx.font = `bold ${fontSize}px Arial`;
                downloadCtx.fillStyle = color;
                downloadCtx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                downloadCtx.lineWidth = 2 * scale;

                const metrics = downloadCtx.measureText(text);
                const textWidth = metrics.width;
                const textHeight = fontSize;

                let coords;
                if (customPosition) {
                    coords = {
                        x: customPosition.x * scale,
                        y: (customPosition.y + parseInt(document.getElementById('fontSize').value)) * scale
                    };
                } else {
                    coords = getPositionCoordinatesForDownload(textWidth, textHeight, downloadCanvas.width, downloadCanvas.height, scale);
                }

                downloadCtx.strokeText(text, coords.x, coords.y);
                downloadCtx.fillText(text, coords.x, coords.y);
            } else if (watermarkType === 'image' && watermarkImage) {
                const sizePercent = document.getElementById('watermarkSize').value / 100;
                const wmWidth = downloadCanvas.width * sizePercent;
                const wmHeight = (watermarkImage.height / watermarkImage.width) * wmWidth;

                let coords;
                if (customPosition) {
                    coords = {
                        x: customPosition.x * scale,
                        y: customPosition.y * scale
                    };
                } else {
                    coords = getPositionCoordinatesForDownload(wmWidth, wmHeight, downloadCanvas.width, downloadCanvas.height, scale);
                }

                downloadCtx.drawImage(watermarkImage, coords.x, coords.y, wmWidth, wmHeight);
            }

            downloadCanvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'watermarked_' + Date.now() + '.png';
                a.click();
                URL.revokeObjectURL(url);
                showToast('Image downloaded!');
            });
        }

        function getPositionCoordinatesForDownload(width, height, canvasWidth, canvasHeight, scale) {
            const padding = 20 * scale;
            let x, y;

            switch (position) {
                case 'top-left':
                    x = padding;
                    y = padding + height;
                    break;
                case 'top-center':
                    x = (canvasWidth - width) / 2;
                    y = padding + height;
                    break;
                case 'top-right':
                    x = canvasWidth - width - padding;
                    y = padding + height;
                    break;
                case 'middle-left':
                    x = padding;
                    y = (canvasHeight + height) / 2;
                    break;
                case 'center':
                    x = (canvasWidth - width) / 2;
                    y = (canvasHeight + height) / 2;
                    break;
                case 'middle-right':
                    x = canvasWidth - width - padding;
                    y = (canvasHeight + height) / 2;
                    break;
                case 'bottom-left':
                    x = padding;
                    y = canvasHeight - padding;
                    break;
                case 'bottom-center':
                    x = (canvasWidth - width) / 2;
                    y = canvasHeight - padding;
                    break;
                case 'bottom-right':
                    x = canvasWidth - width - padding;
                    y = canvasHeight - padding;
                    break;
            }

            return { x, y };
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function uploadNew() {
            document.getElementById('fileInput').click();
        }
    </script>
</body>
</html>
