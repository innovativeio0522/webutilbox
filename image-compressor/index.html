<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor - Compress Images Online Free | ToolKit Pro</title>
    <meta name="description" content="Compress images online for free. Reduce image file size without losing quality. Works offline in your browser. No upload to server.">
    <meta name="keywords" content="image compressor, compress image online, reduce image size, image optimizer">
    <link rel="canonical" href="https://yourdomain.com/image-compressor">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>üì¶ Image Compressor</h1>
        <p class="subtitle">Compress images to reduce file size. Works offline in your browser - no upload to server.</p>

        <div class="workspace">
            <!-- Upload Area -->
            <div style="margin-bottom: 15px;">
                <div style="border: 2px dashed var(--border); border-radius: 8px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s;" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 2rem; margin-bottom: 5px;">üìÅ</div>
                    <div style="font-size: 0.9rem; color: var(--white); margin-bottom: 3px;">Click to upload or drag and drop</div>
                    <div style="font-size: 0.75rem; color: var(--gray);">JPG, PNG, WebP</div>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFile(this.files[0])">
            </div>

            <!-- Quality Slider -->
            <div id="controls" style="display: none; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <label style="font-size: 0.85rem;">Quality</label>
                    <span style="font-size: 0.9rem; font-weight: 600; color: var(--primary);" id="qualityDisplay">80%</span>
                </div>
                <input type="range" id="quality" min="1" max="100" value="80" oninput="updateQuality()" style="width: 100%;">
            </div>

            <!-- Preview & Stats Combined -->
            <div id="preview" style="display: none;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                    <!-- Original -->
                    <div style="background: var(--light); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid var(--border);">
                        <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">Original</div>
                        <img id="originalImg" style="max-width: 100%; max-height: 100px; border-radius: 6px; margin-bottom: 5px;">
                        <div style="font-size: 0.8rem; font-weight: 600; color: var(--white);" id="origSize">0 KB</div>
                    </div>

                    <!-- Compressed -->
                    <div style="background: var(--light); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid var(--border);">
                        <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">Compressed</div>
                        <img id="compressedImg" style="max-width: 100%; max-height: 100px; border-radius: 6px; margin-bottom: 5px;">
                        <div style="font-size: 0.8rem; font-weight: 600; color: var(--secondary);" id="compSize">0 KB</div>
                    </div>

                    <!-- Saved -->
                    <div style="background: var(--light); border-radius: 8px; padding: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid var(--border);">
                        <div style="font-size: 0.75rem; color: var(--gray); margin-bottom: 5px;">Saved</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);" id="savedSize">0%</div>
                    </div>
                </div>

                <!-- Download Button -->
                <button class="btn btn-success" onclick="downloadImage()" style="width: 100%; padding: 10px; font-size: 0.95rem;">Download Compressed Image</button>
            </div>
        </div>

        <div class="info-section">
            <h2>Image Compressor - Reduce Image File Size Online</h2>
            <p>Compress images to reduce file size without significant quality loss. This free image compressor works entirely in your browser - no files are uploaded to any server. Perfect for optimizing images for websites, emails, and social media.</p>
            <p><strong>Privacy:</strong> All compression happens in your browser. Your images never leave your device.</p>
            <p><strong>Supported Formats:</strong> JPG, JPEG, PNG, WebP. Output format matches input format.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        let originalFile = null;
        let compressedBlob = null;

        // Drag and drop
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--primary)';
            dropZone.style.background = 'rgba(249, 115, 22, 0.1)';
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'var(--border)';
            dropZone.style.background = 'transparent';
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--border)';
            dropZone.style.background = 'transparent';
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                showToast('Please select an image file', true);
                return;
            }

            originalFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('originalImg').src = e.target.result;
                document.getElementById('origSize').textContent = formatSize(file.size);
                document.getElementById('controls').style.display = 'block';
                compressImage();
            };
            reader.readAsDataURL(file);
        }

        function updateQuality() {
            const quality = document.getElementById('quality').value;
            document.getElementById('qualityDisplay').textContent = quality + '%';
            console.log('Quality changed to:', quality);
            if (originalFile) {
                console.log('Calling compressImage...');
                compressImage();
            }
        }

        function compressImage() {
            if (!originalFile) return;
            
            const quality = document.getElementById('quality').value / 100;
            console.log('Compressing with quality:', quality);
            const img = new Image();
            img.onload = () => {
                console.log('Image loaded, creating canvas...');
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);

                canvas.toBlob((blob) => {
                    if (!blob) {
                        console.error('Blob creation failed');
                        return;
                    }
                    
                    console.log('Blob created, size:', blob.size);
                    compressedBlob = blob;
                    const url = URL.createObjectURL(blob);
                    
                    // Update compressed image
                    const compImg = document.getElementById('compressedImg');
                    if (compImg.src) URL.revokeObjectURL(compImg.src);
                    compImg.src = url;
                    
                    // Update sizes
                    document.getElementById('compSize').textContent = formatSize(blob.size);
                    
                    // Calculate and update saved percentage
                    const saved = ((originalFile.size - blob.size) / originalFile.size * 100).toFixed(1);
                    console.log('Original size:', originalFile.size, 'Compressed size:', blob.size, 'Saved:', saved + '%');
                    const savedElement = document.getElementById('savedSize');
                    savedElement.textContent = saved + '%';
                    
                    // Change color based on whether we saved or increased size
                    if (parseFloat(saved) < 0) {
                        savedElement.style.color = '#ef4444'; // Red for increased size
                    } else {
                        savedElement.style.color = 'var(--primary)'; // Orange for saved
                    }
                    
                    document.getElementById('preview').style.display = 'block';
                }, 'image/jpeg', quality);
            };
            img.src = document.getElementById('originalImg').src;
        }

        function downloadImage() {
            if (!compressedBlob) return;
            
            const url = URL.createObjectURL(compressedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'compressed_' + (originalFile.name.replace(/\.[^/.]+$/, '') || 'image') + '.jpg';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Image downloaded!');
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
