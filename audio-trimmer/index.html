<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Trimmer - Cut and Trim Audio Files | ToolKit Pro</title>
    <meta name="description" content="Trim and cut audio files online. Upload audio, select start/end points, and download trimmed audio. Free offline audio trimmer.">
    <meta name="keywords" content="audio trimmer, audio cutter, trim audio, cut audio, audio editor">
    <link rel="canonical" href="https://yourdomain.com/audio-trimmer">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>‚úÇÔ∏è Audio Trimmer</h1>
        <p class="subtitle">Trim and cut audio files. Select start and end points to extract the part you need.</p>

        <div class="workspace">
            <!-- Upload -->
            <div style="text-align: center; padding: 40px; border: 2px dashed var(--border); border-radius: 12px; background: var(--light); margin-bottom: 20px;">
                <div style="font-size: 3rem; margin-bottom: 15px;">üéµ</div>
                <input type="file" id="audioFile" accept="audio/*" style="display: none;" onchange="loadAudio()">
                <button class="btn btn-primary" onclick="document.getElementById('audioFile').click()">Upload Audio File</button>
                <p style="margin-top: 10px; font-size: 0.85rem; color: var(--gray);">Supports MP3, WAV, OGG, M4A</p>
            </div>

            <!-- Audio Player & Controls -->
            <div id="audioControls" style="display: none;">
                <div style="background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                    <audio id="audioPlayer" controls style="width: 100%; margin-bottom: 15px;"></audio>
                    
                    <div style="margin-bottom: 15px;">
                        <canvas id="waveform" style="width: 100%; height: 80px; background: var(--dark); border-radius: 8px; cursor: pointer;"></canvas>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="font-size: 0.85rem; margin-bottom: 6px; display: block;">Start Time (seconds)</label>
                            <input type="number" id="startTime" value="0" min="0" step="0.1" oninput="updateSelection()" style="width: 100%; padding: 10px;">
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; margin-bottom: 6px; display: block;">End Time (seconds)</label>
                            <input type="number" id="endTime" value="0" min="0" step="0.1" oninput="updateSelection()" style="width: 100%; padding: 10px;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-primary" onclick="previewTrimmed()">Preview Trimmed</button>
                        <button class="btn btn-success" onclick="downloadTrimmed()">Download Trimmed Audio</button>
                    </div>

                    <div id="trimInfo" style="margin-top: 15px; padding: 12px; background: rgba(249, 115, 22, 0.1); border-radius: 8px; text-align: center; font-size: 0.9rem;">
                        <span id="durationInfo"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>Audio Trimmer - Cut Audio Files</h2>
            <p>Trim and cut audio files directly in your browser. Upload an audio file, select the start and end points, and download the trimmed version.</p>
            <p><strong>Features:</strong> Visual waveform, precise time selection, preview before download, supports multiple audio formats.</p>
            <p><strong>Privacy:</strong> All processing happens in your browser. No files are uploaded to any server.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        let audioContext;
        let audioBuffer;
        let sourceNode;
        let fileName = '';

        async function loadAudio() {
            const file = document.getElementById('audioFile').files[0];
            if (!file) return;

            fileName = file.name.split('.')[0];
            const arrayBuffer = await file.arrayBuffer();
            
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

            const player = document.getElementById('audioPlayer');
            player.src = URL.createObjectURL(file);

            document.getElementById('endTime').value = audioBuffer.duration.toFixed(2);
            document.getElementById('endTime').max = audioBuffer.duration;
            document.getElementById('startTime').max = audioBuffer.duration;

            drawWaveform();
            updateSelection();
            document.getElementById('audioControls').style.display = 'block';
            showToast('Audio loaded successfully!');
        }

        function drawWaveform() {
            const canvas = document.getElementById('waveform');
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            const data = audioBuffer.getChannelData(0);
            const step = Math.ceil(data.length / width);
            const amp = height / 2;

            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);

            ctx.strokeStyle = '#f97316';
            ctx.lineWidth = 1;
            ctx.beginPath();

            for (let i = 0; i < width; i++) {
                let min = 1.0;
                let max = -1.0;
                for (let j = 0; j < step; j++) {
                    const datum = data[(i * step) + j];
                    if (datum < min) min = datum;
                    if (datum > max) max = datum;
                }
                ctx.moveTo(i, (1 + min) * amp);
                ctx.lineTo(i, (1 + max) * amp);
            }
            ctx.stroke();
        }

        function updateSelection() {
            const start = parseFloat(document.getElementById('startTime').value) || 0;
            const end = parseFloat(document.getElementById('endTime').value) || audioBuffer.duration;
            const duration = (end - start).toFixed(2);

            document.getElementById('durationInfo').textContent = 
                `Trimmed duration: ${duration}s (from ${start.toFixed(2)}s to ${end.toFixed(2)}s)`;
        }

        function previewTrimmed() {
            const start = parseFloat(document.getElementById('startTime').value) || 0;
            const player = document.getElementById('audioPlayer');
            player.currentTime = start;
            player.play();

            const end = parseFloat(document.getElementById('endTime').value);
            const checkTime = setInterval(() => {
                if (player.currentTime >= end) {
                    player.pause();
                    clearInterval(checkTime);
                }
            }, 100);
        }

        async function downloadTrimmed() {
            const start = parseFloat(document.getElementById('startTime').value) || 0;
            const end = parseFloat(document.getElementById('endTime').value) || audioBuffer.duration;

            if (start >= end) {
                showToast('Start time must be less than end time', true);
                return;
            }

            const startOffset = Math.floor(start * audioBuffer.sampleRate);
            const endOffset = Math.floor(end * audioBuffer.sampleRate);
            const frameCount = endOffset - startOffset;

            const trimmedBuffer = audioContext.createBuffer(
                audioBuffer.numberOfChannels,
                frameCount,
                audioBuffer.sampleRate
            );

            for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
                const sourceData = audioBuffer.getChannelData(channel);
                const trimmedData = trimmedBuffer.getChannelData(channel);
                for (let i = 0; i < frameCount; i++) {
                    trimmedData[i] = sourceData[startOffset + i];
                }
            }

            const wav = audioBufferToWav(trimmedBuffer);
            const blob = new Blob([wav], { type: 'audio/wav' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}_trimmed.wav`;
            a.click();

            showToast('Audio trimmed and downloaded!');
        }

        function audioBufferToWav(buffer) {
            const length = buffer.length * buffer.numberOfChannels * 2 + 44;
            const arrayBuffer = new ArrayBuffer(length);
            const view = new DataView(arrayBuffer);
            const channels = [];
            let offset = 0;
            let pos = 0;

            function setUint16(data) {
                view.setUint16(pos, data, true);
                pos += 2;
            }

            function setUint32(data) {
                view.setUint32(pos, data, true);
                pos += 4;
            }

            setUint32(0x46464952);
            setUint32(length - 8);
            setUint32(0x45564157);
            setUint32(0x20746d66);
            setUint32(16);
            setUint16(1);
            setUint16(buffer.numberOfChannels);
            setUint32(buffer.sampleRate);
            setUint32(buffer.sampleRate * 2 * buffer.numberOfChannels);
            setUint16(buffer.numberOfChannels * 2);
            setUint16(16);
            setUint32(0x61746164);
            setUint32(length - pos - 4);

            for (let i = 0; i < buffer.numberOfChannels; i++) {
                channels.push(buffer.getChannelData(i));
            }

            while (pos < length) {
                for (let i = 0; i < buffer.numberOfChannels; i++) {
                    let sample = Math.max(-1, Math.min(1, channels[i][offset]));
                    sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
                    view.setInt16(pos, sample, true);
                    pos += 2;
                }
                offset++;
            }

            return arrayBuffer;
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
