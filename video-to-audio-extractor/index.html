<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video to Audio Extractor - Extract Audio from Video | ToolKit Pro</title>
    <meta name="description" content="Extract audio track from video files. Convert video to MP3 or WAV. Free video to audio converter.">
    <meta name="keywords" content="video to audio, extract audio, video converter, mp3 converter, audio extractor">
    <link rel="canonical" href="https://yourdomain.com/video-to-audio-extractor">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>üéµ Video to Audio Extractor</h1>
        <p class="subtitle">Extract audio track from video files. Convert video to audio format.</p>

        <div class="workspace">
            <!-- Upload Area -->
            <div style="text-align: center; padding: 40px; border: 2px dashed var(--border); border-radius: 12px; background: var(--light); margin-bottom: 20px;">
                <div style="font-size: 3rem; margin-bottom: 15px;">üé•</div>
                <input type="file" id="videoFile" accept="video/*" style="display: none;" onchange="loadVideo()">
                <button class="btn btn-primary" onclick="document.getElementById('videoFile').click()" style="padding: 15px 30px;">
                    Select Video File
                </button>
                <p style="margin-top: 10px; font-size: 0.85rem; color: var(--gray);">Supports MP4, WebM, MOV, AVI, etc.</p>
            </div>

            <!-- Video Info & Controls -->
            <div id="videoControls" style="display: none;">
                <!-- Video Preview -->
                <div style="background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                    <h3 style="font-size: 1rem; margin-bottom: 15px;">Video Preview</h3>
                    <video id="videoPlayer" controls style="width: 100%; max-height: 300px; border-radius: 8px; background: #000; margin-bottom: 15px;"></video>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray);">File Name</div>
                            <div id="fileName" style="font-weight: 600; word-break: break-all;"></div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Duration</div>
                            <div id="videoDuration" style="font-weight: 600; font-size: 1.1rem;"></div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Resolution</div>
                            <div id="videoResolution" style="font-weight: 600; font-size: 1.1rem;"></div>
                        </div>
                    </div>
                </div>

                <!-- Extraction Options -->
                <div style="background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                    <h3 style="font-size: 1rem; margin-bottom: 15px;">Audio Extraction Options</h3>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="font-size: 0.85rem; margin-bottom: 6px; display: block;">Output Format</label>
                            <select id="audioFormat" style="width: 100%; padding: 10px;">
                                <option value="mp3">MP3 (Compressed)</option>
                                <option value="wav">WAV (Uncompressed)</option>
                                <option value="ogg">OGG (Compressed)</option>
                            </select>
                        </div>

                        <div>
                            <label style="font-size: 0.85rem; margin-bottom: 6px; display: block;">Quality</label>
                            <select id="audioQuality" style="width: 100%; padding: 10px;">
                                <option value="high">High (192 kbps)</option>
                                <option value="medium" selected>Medium (128 kbps)</option>
                                <option value="low">Low (96 kbps)</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="font-size: 0.85rem; margin-bottom: 6px; display: block;">Extract Range (Optional)</label>
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center;">
                            <input type="number" id="startTime" min="0" step="0.1" placeholder="Start (seconds)" style="padding: 10px;">
                            <span style="color: var(--gray);">to</span>
                            <input type="number" id="endTime" min="0" step="0.1" placeholder="End (seconds)" style="padding: 10px;">
                        </div>
                        <p style="font-size: 0.75rem; color: var(--gray); margin-top: 5px;">Leave empty to extract full audio</p>
                    </div>

                    <button class="btn btn-success" onclick="extractAudio()" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                        üéµ Extract Audio
                    </button>
                </div>

                <!-- Audio Preview -->
                <div id="audioPreview" style="display: none; background: var(--light); border-radius: 12px; padding: 20px; border: 1px solid var(--border);">
                    <h3 style="font-size: 1rem; margin-bottom: 15px;">Extracted Audio</h3>
                    <audio id="audioPlayer" controls style="width: 100%; margin-bottom: 15px;"></audio>
                    <button class="btn btn-success" onclick="downloadAudio()" style="width: 100%; padding: 12px;">
                        Download Audio
                    </button>
                </div>
            </div>

            <!-- Progress -->
            <div id="progress" style="display: none; background: var(--light); border-radius: 12px; padding: 20px; border: 1px solid var(--border); text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 10px;">‚è≥</div>
                <div id="progressText" style="font-size: 1rem; color: var(--gray);">Extracting audio...</div>
            </div>
        </div>

        <div class="info-section">
            <h2>Video to Audio Extractor</h2>
            <p>Extract audio track from video files and save as MP3, WAV, or OGG. Optionally extract specific time ranges.</p>
            <p><strong>Features:</strong> Multiple output formats, quality control, time range selection, preview before download.</p>
            <p><strong>Privacy:</strong> All processing happens in your browser. No files are uploaded to any server.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        let video = null;
        let audioContext = null;
        let audioBlob = null;
        let originalFileName = '';

        function loadVideo() {
            const file = document.getElementById('videoFile').files[0];
            if (!file) return;

            originalFileName = file.name.replace(/\.[^/.]+$/, '');
            video = document.getElementById('videoPlayer');
            video.src = URL.createObjectURL(file);

            video.addEventListener('loadedmetadata', () => {
                const duration = formatTime(video.duration);
                const resolution = `${video.videoWidth} √ó ${video.videoHeight}`;
                
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('videoDuration').textContent = duration;
                document.getElementById('videoResolution').textContent = resolution;
                document.getElementById('endTime').max = video.duration;
                document.getElementById('startTime').max = video.duration;
                document.getElementById('endTime').placeholder = `End (max: ${video.duration.toFixed(1)}s)`;
                
                document.getElementById('videoControls').style.display = 'block';
                showToast('Video loaded successfully!');
            });
        }

        async function extractAudio() {
            if (!video) {
                showToast('Please select a video file first', true);
                return;
            }

            document.getElementById('progress').style.display = 'block';
            document.getElementById('progressText').textContent = 'Extracting audio...';

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create media element source
                const source = audioContext.createMediaElementSource(video);
                const destination = audioContext.createMediaStreamDestination();
                source.connect(destination);
                source.connect(audioContext.destination);

                // Record audio
                const mediaRecorder = new MediaRecorder(destination.stream);
                const chunks = [];

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) {
                        chunks.push(e.data);
                    }
                };

                mediaRecorder.onstop = async () => {
                    audioBlob = new Blob(chunks, { type: 'audio/webm' });
                    
                    // Convert to selected format
                    const format = document.getElementById('audioFormat').value;
                    await convertAudioFormat(audioBlob, format);
                    
                    document.getElementById('progress').style.display = 'none';
                    showToast('Audio extracted successfully!');
                };

                // Get time range
                const startTime = parseFloat(document.getElementById('startTime').value) || 0;
                const endTime = parseFloat(document.getElementById('endTime').value) || video.duration;

                video.currentTime = startTime;
                video.play();

                mediaRecorder.start();

                // Stop recording at end time
                setTimeout(() => {
                    mediaRecorder.stop();
                    video.pause();
                }, (endTime - startTime) * 1000);

            } catch (error) {
                document.getElementById('progress').style.display = 'none';
                showToast('Error extracting audio: ' + error.message, true);
            }
        }

        async function convertAudioFormat(blob, format) {
            // For now, we'll use the WebM audio as-is
            // In a production app, you'd use a library like ffmpeg.wasm for format conversion
            const url = URL.createObjectURL(blob);
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = url;
            document.getElementById('audioPreview').style.display = 'block';
        }

        function downloadAudio() {
            if (!audioBlob) return;

            const format = document.getElementById('audioFormat').value;
            const url = URL.createObjectURL(audioBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${originalFileName}_audio.${format === 'mp3' ? 'mp3' : format === 'wav' ? 'wav' : 'ogg'}`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Audio downloaded!');
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
