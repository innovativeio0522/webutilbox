<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to CSV Converter - Free Online Tool | ToolKit Pro</title>
    <meta name="description" content="Convert JSON to CSV format instantly. Download as CSV file, preview data in table format. Works offline with nested JSON support.">
    <meta name="keywords" content="json to csv, json converter, csv converter, json to csv online, convert json">
    <link rel="canonical" href="https://yourdomain.com/json-to-csv">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>üìä JSON to CSV Converter</h1>
        <p class="subtitle">Convert JSON data to CSV format with preview and download.</p>

        <div class="workspace" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <!-- Left: JSON Input -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 0.8rem; color: var(--gray);">JSON Input</label>
                    <div style="display: flex; gap: 6px;">
                        <button id="loadSampleBtn" style="padding: 4px 10px; font-size: 0.7rem; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; color: var(--white); cursor: pointer;">üìÑ Sample</button>
                        <button id="clearBtn" style="padding: 4px 10px; font-size: 0.7rem; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; color: var(--white); cursor: pointer;">üóëÔ∏è Clear</button>
                    </div>
                </div>
                <textarea id="jsonInput" placeholder='[
  {"name": "John", "age": 30, "city": "New York"},
  {"name": "Jane", "age": 25, "city": "London"}
]' style="width: 100%; height: 500px; padding: 12px; font-size: 0.85rem; font-family: monospace; background: var(--dark); border: 1px solid var(--border); border-radius: 8px; color: var(--white); resize: vertical;"></textarea>
                
                <div style="display: flex; gap: 10px; margin-top: 12px;">
                    <button id="convertBtn" style="flex: 1; padding: 10px; background: var(--primary); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 0.9rem; font-weight: 500;">Convert to CSV</button>
                </div>
            </div>

            <!-- Right: CSV Output -->
            <div>
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <button id="previewTab" style="flex: 1; padding: 8px; background: var(--primary); border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: white; font-weight: 500;">Table Preview</button>
                    <button id="csvTab" style="flex: 1; padding: 8px; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: var(--white); font-weight: 500;">CSV Text</button>
                </div>

                <!-- Table Preview -->
                <div id="previewDiv" style="background: var(--light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); min-height: 500px; max-height: 500px; overflow: auto;">
                    <div style="text-align: center; padding: 60px 20px; color: var(--gray); font-size: 0.85rem;">
                        Enter JSON and click Convert to see preview
                    </div>
                </div>

                <!-- CSV Text -->
                <textarea id="csvOutput" readonly style="display: none; width: 100%; height: 500px; padding: 12px; font-size: 0.8rem; font-family: monospace; background: var(--dark); border: 1px solid var(--border); border-radius: 8px; color: var(--white); resize: vertical;"></textarea>

                <div style="display: flex; gap: 10px; margin-top: 12px;">
                    <button id="copyBtn" style="flex: 1; padding: 10px; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--white); cursor: pointer; font-size: 0.85rem;">üìã Copy CSV</button>
                    <button id="downloadBtn" style="flex: 1; padding: 10px; background: var(--primary); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 0.85rem;">üíæ Download CSV</button>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>JSON to CSV Converter</h2>
            <p>Convert JSON arrays to CSV format with automatic column detection. Supports nested objects (flattened with dot notation) and handles missing fields gracefully.</p>
            <p><strong>Features:</strong> Table preview, CSV text view, copy to clipboard, download as file, automatic header detection, nested object support.</p>
            <p><strong>Use Cases:</strong> Export API responses, convert database dumps, prepare data for Excel, data analysis, reporting, data migration.</p>
            <p><strong>Privacy:</strong> All conversion happens in your browser. No data is sent to any server.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        const jsonInput = document.getElementById('jsonInput');
        const csvOutput = document.getElementById('csvOutput');
        const previewDiv = document.getElementById('previewDiv');
        const previewTab = document.getElementById('previewTab');
        const csvTab = document.getElementById('csvTab');
        const convertBtn = document.getElementById('convertBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const loadSampleBtn = document.getElementById('loadSampleBtn');
        const clearBtn = document.getElementById('clearBtn');

        let currentTab = 'preview';
        let csvData = '';

        previewTab.addEventListener('click', () => switchTab('preview'));
        csvTab.addEventListener('click', () => switchTab('csv'));
        convertBtn.addEventListener('click', convertToCSV);
        copyBtn.addEventListener('click', copyCSV);
        downloadBtn.addEventListener('click', downloadCSV);
        loadSampleBtn.addEventListener('click', loadSample);
        clearBtn.addEventListener('click', () => {
            jsonInput.value = '';
            csvOutput.value = '';
            csvData = '';
            previewDiv.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--gray); font-size: 0.85rem;">Enter JSON and click Convert to see preview</div>';
            showToast('Cleared');
        });

        function switchTab(tab) {
            currentTab = tab;
            
            if (tab === 'preview') {
                previewTab.style.background = 'var(--primary)';
                previewTab.style.border = 'none';
                csvTab.style.background = 'var(--dark)';
                csvTab.style.border = '1px solid var(--border)';
                previewDiv.style.display = 'block';
                csvOutput.style.display = 'none';
            } else {
                csvTab.style.background = 'var(--primary)';
                csvTab.style.border = 'none';
                previewTab.style.background = 'var(--dark)';
                previewTab.style.border = '1px solid var(--border)';
                previewDiv.style.display = 'none';
                csvOutput.style.display = 'block';
            }
        }

        function flattenObject(obj, prefix = '') {
            const flattened = {};
            
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    const newKey = prefix ? `${prefix}.${key}` : key;
                    
                    if (value !== null && typeof value === 'object' && !Array.isArray(value)) {
                        Object.assign(flattened, flattenObject(value, newKey));
                    } else if (Array.isArray(value)) {
                        flattened[newKey] = JSON.stringify(value);
                    } else {
                        flattened[newKey] = value;
                    }
                }
            }
            
            return flattened;
        }

        function escapeCSV(value) {
            if (value === null || value === undefined) return '';
            const str = String(value);
            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function convertToCSV() {
            const input = jsonInput.value.trim();
            
            if (!input) {
                showToast('Please enter JSON data', true);
                return;
            }
            
            try {
                let data = JSON.parse(input);
                
                // Handle single object - convert to array
                if (!Array.isArray(data)) {
                    data = [data];
                }
                
                if (data.length === 0) {
                    showToast('JSON array is empty', true);
                    return;
                }
                
                // Flatten all objects
                const flatData = data.map(item => flattenObject(item));
                
                // Get all unique keys (columns)
                const allKeys = new Set();
                flatData.forEach(item => {
                    Object.keys(item).forEach(key => allKeys.add(key));
                });
                const headers = Array.from(allKeys);
                
                // Build CSV
                const csvRows = [];
                
                // Add header row
                csvRows.push(headers.map(h => escapeCSV(h)).join(','));
                
                // Add data rows
                flatData.forEach(item => {
                    const row = headers.map(header => escapeCSV(item[header]));
                    csvRows.push(row.join(','));
                });
                
                csvData = csvRows.join('\n');
                csvOutput.value = csvData;
                
                // Create table preview
                createTablePreview(headers, flatData);
                
                showToast('Converted successfully!');
                
            } catch (error) {
                showToast('Invalid JSON: ' + error.message, true);
                previewDiv.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #e74c3c; font-size: 0.85rem;">Error: ' + error.message + '</div>';
            }
        }

        function createTablePreview(headers, data) {
            let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; font-size: 0.75rem;">';
            
            // Header
            html += '<thead><tr>';
            headers.forEach(header => {
                html += `<th style="background: var(--dark); color: var(--white); padding: 8px; border: 1px solid var(--border); text-align: left; font-weight: 600; white-space: nowrap;">${escapeHTML(header)}</th>`;
            });
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            data.forEach((row, idx) => {
                html += '<tr>';
                headers.forEach(header => {
                    const value = row[header] !== undefined ? row[header] : '';
                    html += `<th style="background: ${idx % 2 === 0 ? 'var(--dark)' : '#1a1a1a'}; color: var(--white); padding: 8px; border: 1px solid var(--border); font-weight: normal; white-space: nowrap;">${escapeHTML(String(value))}</th>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';
            
            html += '</table></div>';
            
            html += `<div style="margin-top: 12px; font-size: 0.75rem; color: var(--gray);">
                ${data.length} row${data.length !== 1 ? 's' : ''}, ${headers.length} column${headers.length !== 1 ? 's' : ''}
            </div>`;
            
            previewDiv.innerHTML = html;
        }

        function escapeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function copyCSV() {
            if (!csvData) {
                showToast('No CSV data to copy', true);
                return;
            }
            
            navigator.clipboard.writeText(csvData).then(() => {
                showToast('CSV copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy', true);
            });
        }

        function downloadCSV() {
            if (!csvData) {
                showToast('No CSV data to download', true);
                return;
            }
            
            const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data_' + Date.now() + '.csv';
            a.click();
            URL.revokeObjectURL(url);
            showToast('CSV file downloaded!');
        }

        function loadSample() {
            const sample = `[
  {
    "id": 1,
    "name": "John Doe",
    "email": "john@example.com",
    "age": 30,
    "city": "New York",
    "active": true
  },
  {
    "id": 2,
    "name": "Jane Smith",
    "email": "jane@example.com",
    "age": 25,
    "city": "London",
    "active": true
  },
  {
    "id": 3,
    "name": "Bob Johnson",
    "email": "bob@example.com",
    "age": 35,
    "city": "Paris",
    "active": false
  }
]`;
            jsonInput.value = sample;
            showToast('Sample loaded!');
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
