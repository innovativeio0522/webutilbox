<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Splitter - Split PDF into Separate Pages | ToolKit Pro</title>
    <meta name="description" content="Split PDF files into separate pages or extract specific pages. Free online PDF splitter, works offline.">
    <meta name="keywords" content="pdf splitter, split pdf, extract pdf pages, pdf separator, divide pdf">
    <link rel="canonical" href="https://yourdomain.com/pdf-splitter">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool-specific.css">
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../" class="logo">
                <span>üß∞</span>
                <span>ToolKit Pro</span>
            </a>
        </div>
    </header>

    <div class="container">
        <h1>‚úÇÔ∏è PDF Splitter</h1>
        <p class="subtitle">Split PDF files into separate pages or extract specific page ranges.</p>

        <div class="workspace">
            <!-- Upload Area -->
            <div style="text-align: center; padding: 40px; border: 2px dashed var(--border); border-radius: 12px; background: var(--light); margin-bottom: 20px;">
                <div style="font-size: 3rem; margin-bottom: 15px;">üìÑ</div>
                <input type="file" id="pdfFile" accept=".pdf" style="display: none;" onchange="loadPDF()">
                <button class="btn btn-primary" onclick="document.getElementById('pdfFile').click()" style="padding: 15px 30px; font-size: 1rem;">
                    Select PDF File
                </button>
                <p style="margin-top: 10px; font-size: 0.85rem; color: var(--gray);">Choose a PDF file to split</p>
            </div>

            <!-- PDF Info & Options -->
            <div id="pdfOptions" style="display: none;">
                <!-- PDF Info -->
                <div style="background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                    <h3 style="font-size: 1rem; margin-bottom: 15px;">PDF Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">File Name</div>
                            <div id="fileName" style="font-weight: 600; word-break: break-all;"></div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">Total Pages</div>
                            <div id="totalPages" style="font-weight: 600; font-size: 1.2rem; color: var(--primary);"></div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">File Size</div>
                            <div id="fileSize" style="font-weight: 600;"></div>
                        </div>
                    </div>
                </div>

                <!-- Split Options -->
                <div style="background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                    <h3 style="font-size: 1rem; margin-bottom: 15px;">Split Options</h3>
                    
                    <!-- Mode Selection -->
                    <div style="margin-bottom: 20px;">
                        <label style="font-size: 0.9rem; margin-bottom: 10px; display: block; font-weight: 600;">Split Mode</label>
                        <select id="splitMode" onchange="updateMode()" style="width: 100%; padding: 12px; font-size: 1rem;">
                            <option value="all">Split into individual pages</option>
                            <option value="range">Extract specific page range</option>
                            <option value="custom">Extract specific pages</option>
                        </select>
                    </div>

                    <!-- Range Input (hidden by default) -->
                    <div id="rangeInput" style="display: none; margin-bottom: 20px;">
                        <label style="font-size: 0.9rem; margin-bottom: 10px; display: block; font-weight: 600;">Page Range</label>
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center;">
                            <input type="number" id="startPage" min="1" placeholder="Start" style="padding: 10px; text-align: center;">
                            <span style="color: var(--gray);">to</span>
                            <input type="number" id="endPage" min="1" placeholder="End" style="padding: 10px; text-align: center;">
                        </div>
                    </div>

                    <!-- Custom Pages Input (hidden by default) -->
                    <div id="customInput" style="display: none; margin-bottom: 20px;">
                        <label style="font-size: 0.9rem; margin-bottom: 10px; display: block; font-weight: 600;">Page Numbers</label>
                        <input type="text" id="customPages" placeholder="e.g., 1,3,5-7,10" style="width: 100%; padding: 12px;">
                        <p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">Enter page numbers separated by commas. Use dash for ranges (e.g., 1,3,5-7,10)</p>
                    </div>

                    <button class="btn btn-success" onclick="splitPDF()" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                        ‚úÇÔ∏è Split PDF
                    </button>
                </div>
            </div>

            <!-- Progress -->
            <div id="progress" style="display: none; background: var(--light); border-radius: 12px; padding: 20px; border: 1px solid var(--border); text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 10px;">‚è≥</div>
                <div id="progressText" style="font-size: 1rem; color: var(--gray);">Processing PDF...</div>
            </div>
        </div>

        <div class="info-section">
            <h2>PDF Splitter - Extract PDF Pages</h2>
            <p>Split PDF files into individual pages or extract specific pages. Choose to split all pages or select custom page ranges.</p>
            <p><strong>Features:</strong> Split into individual pages, extract page ranges, extract specific pages, maintains PDF quality.</p>
            <p><strong>Privacy:</strong> All processing happens in your browser. No files are uploaded to any server.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        const { PDFDocument } = PDFLib;
        let pdfDoc = null;
        let pdfBytes = null;
        let originalFileName = '';

        async function loadPDF() {
            const file = document.getElementById('pdfFile').files[0];
            if (!file) return;

            try {
                originalFileName = file.name.replace('.pdf', '');
                pdfBytes = await file.arrayBuffer();
                pdfDoc = await PDFDocument.load(pdfBytes);

                const pageCount = pdfDoc.getPageCount();

                document.getElementById('fileName').textContent = file.name;
                document.getElementById('totalPages').textContent = pageCount;
                document.getElementById('fileSize').textContent = formatFileSize(file.size);
                document.getElementById('startPage').max = pageCount;
                document.getElementById('endPage').max = pageCount;
                document.getElementById('endPage').value = pageCount;

                document.getElementById('pdfOptions').style.display = 'block';
                showToast('PDF loaded successfully!');
            } catch (error) {
                showToast('Error loading PDF: ' + error.message, true);
            }
        }

        function updateMode() {
            const mode = document.getElementById('splitMode').value;
            document.getElementById('rangeInput').style.display = mode === 'range' ? 'block' : 'none';
            document.getElementById('customInput').style.display = mode === 'custom' ? 'block' : 'none';
        }

        async function splitPDF() {
            if (!pdfDoc) {
                showToast('Please select a PDF file first', true);
                return;
            }

            const mode = document.getElementById('splitMode').value;
            const totalPages = pdfDoc.getPageCount();

            document.getElementById('progress').style.display = 'block';

            try {
                if (mode === 'all') {
                    await splitAllPages(totalPages);
                } else if (mode === 'range') {
                    await splitRange();
                } else if (mode === 'custom') {
                    await splitCustom();
                }

                document.getElementById('progress').style.display = 'none';
                showToast('PDF split successfully!');
            } catch (error) {
                document.getElementById('progress').style.display = 'none';
                showToast('Error splitting PDF: ' + error.message, true);
            }
        }

        async function splitAllPages(totalPages) {
            for (let i = 0; i < totalPages; i++) {
                document.getElementById('progressText').textContent = 
                    `Extracting page ${i + 1} of ${totalPages}...`;

                const newPdf = await PDFDocument.create();
                const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);
                newPdf.addPage(copiedPage);

                const pdfBytes = await newPdf.save();
                downloadPDF(pdfBytes, `${originalFileName}_page_${i + 1}.pdf`);
            }
        }

        async function splitRange() {
            const start = parseInt(document.getElementById('startPage').value) - 1;
            const end = parseInt(document.getElementById('endPage').value) - 1;

            if (isNaN(start) || isNaN(end) || start < 0 || end >= pdfDoc.getPageCount() || start > end) {
                throw new Error('Invalid page range');
            }

            document.getElementById('progressText').textContent = 
                `Extracting pages ${start + 1} to ${end + 1}...`;

            const newPdf = await PDFDocument.create();
            const pageIndices = [];
            for (let i = start; i <= end; i++) {
                pageIndices.push(i);
            }

            const copiedPages = await newPdf.copyPages(pdfDoc, pageIndices);
            copiedPages.forEach(page => newPdf.addPage(page));

            const pdfBytes = await newPdf.save();
            downloadPDF(pdfBytes, `${originalFileName}_pages_${start + 1}-${end + 1}.pdf`);
        }

        async function splitCustom() {
            const input = document.getElementById('customPages').value.trim();
            if (!input) {
                throw new Error('Please enter page numbers');
            }

            const pageIndices = parsePageNumbers(input, pdfDoc.getPageCount());
            if (pageIndices.length === 0) {
                throw new Error('No valid page numbers found');
            }

            document.getElementById('progressText').textContent = 
                `Extracting ${pageIndices.length} page(s)...`;

            const newPdf = await PDFDocument.create();
            const copiedPages = await newPdf.copyPages(pdfDoc, pageIndices);
            copiedPages.forEach(page => newPdf.addPage(page));

            const pdfBytes = await newPdf.save();
            downloadPDF(pdfBytes, `${originalFileName}_custom.pdf`);
        }

        function parsePageNumbers(input, maxPages) {
            const pages = new Set();
            const parts = input.split(',');

            for (const part of parts) {
                const trimmed = part.trim();
                if (trimmed.includes('-')) {
                    const [start, end] = trimmed.split('-').map(n => parseInt(n.trim()));
                    if (!isNaN(start) && !isNaN(end) && start > 0 && end <= maxPages && start <= end) {
                        for (let i = start; i <= end; i++) {
                            pages.add(i - 1);
                        }
                    }
                } else {
                    const num = parseInt(trimmed);
                    if (!isNaN(num) && num > 0 && num <= maxPages) {
                        pages.add(num - 1);
                    }
                }
            }

            return Array.from(pages).sort((a, b) => a - b);
        }

        function downloadPDF(pdfBytes, filename) {
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            msg.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
